EmailEvents
//filter for inbound traffic
|where EmailDirection == "Inbound"
// filter for Public Folder related traffic -this will be unique per tenant
//| where RecipientEmailAddress !in ("secondaryhierarchy_939696f8@contoso.onmicrosoft.com", "hierarchy_aa1957ba@contoso.onmicrosoft.com")
| where ConfidenceLevel != @"{""Spam"":""Not spam""}"
//Filter internal routing domain email out
| where SenderFromDomain != "contoso.onmicrosoft.com"
//These fields should show if there is an Mail Rule or Safelist entry for the message - for some reason - the kql does not filter if they are NullValues
|where isnotnull(EmailActionPolicy) or isnotnull(EmailAction) or isnotnull (EmailActionPolicyGuid)  or isnotnull (OrgLevelAction) or isnotnull (OrgLevelPolicy)
